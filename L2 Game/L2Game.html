<!doctype html>
<head> 
    <title>Velocity</title>
    <link rel="stylesheet" href="L2Styles.css">
</head>
<body>
    <canvas id="gameCanvas" width="600" height="600"></canvas>
    <script>
        var canvas, canvasContext;

        window.onload = function(){
            canvas = document.getElementById('gameCanvas');
            canvasContext = canvas.getContext('2d');
            
            document.addEventListener('keydown', keyPressed);
            document.addEventListener('keyup', keyReleased);

            setInterval(mainloop, 1000/50);
            
        }
    // Player Vars  
    var player = new Image();
    player.src = 'Images/Player Edited.png';
    var playerXpos = 250;
    var playerYpos = 500;
    var playerXspeed = 15;
    var playerYspeed = 0;
    var PLAYER_SIZE = 20;
    
    // Enemy Vars
    var enemyPic = new Image();
    enemyPic.src= 'Images/Enemy Edited.png';
//    var enemyXpos = 0;
//    var enemyYpos = 0;
//    var enemyXspeed = 5;
//    var enemyYspeed = 5;
//    var ENEMY_SIZE = 130;
    
    var enemies = [];
    var totalEnimies = 1;
    var startingPos = true;
    

    // Key Vars
    var leftKeyPress = false;
    var rightKeyPress = false;
    var upKeyPress = false;
    var downKeyPress = false;  
    const LEFT_KEY = 37;
    const RIGHT_KEY = 39;
    const UP_KEY = 38;
    const DOWN_KEY = 40;
    
    // Background Vars
    var backgroundWidth = 700;
    var backgroundHeight = 700;
    var background = new Image();
    background.src = 'Images/Background 2.png';
    
    var life = 3;
    
        
    function mainloop(){
        drawImage(background,0,0,backgroundHeight,backgroundWidth,'background')// Canvas
        drawImage(player,playerXpos,playerYpos,120,100,'red')// Player
        
         if(startingPos){
           for(i=0; i < totalEnimies; i++){
                makeEnemy();
             
            }
            startingPos = false;
        }
        
        
        enemyMove();
        makeEnemy();
        playerMove();
        drawnEnemy();
    } // Mainloop
        
    
       function makeEnemy(){
        var enemyPos = Math.floor(Math.random()* 3) + 1;
        
        const ENEMY_SIZE = 40;
        //var enemyXpos = Math.floor(Math.random()*(canvas.width - ENEMY_SIZE));
        var enemyXpos = enemyPos * canvas.width / 3;
        var enemyYpos = 0 - ENEMY_SIZE;
        var enemyXspeed = Math.floor(Math.random() * (12 - 5) + 3);
        var enemyYspeed = Math.floor(Math.random() * (12 - 5) + 3);
           
        var enemy = {
            enemyXpos: enemyXpos,
            enemyYpos: enemyYpos,
            ENEMY_SIZE: ENEMY_SIZE,
            enemyYspeed: enemyYspeed,
            enemyXspeed: enemyYspeed
            
        }
        
        enemies.push(enemy);
        
    }// Make multiple enemys
    
    function drawnEnemy(){
        enemies.forEach(function(enemy, i){
            drawImage(enemyPic, enemy.enemyXpos, enemy.enemyYpos,enemy.ENEMY_SIZE,enemy.ENEMY_SIZE,'red')// Enemys Spawn
        });
    }
        
        
        function enemyMove(){
            enemies.forEach(function(enemy){
                
            
            
            enemy.enemyYpos += enemy.enemyYspeed;
            
            if(enemy.enemyYpos > canvas.height){
                enemy.enemyYpos = 0 - enemy.ENEMY_SIZE;
                enemy.enemyXpos = Math.floor(Math.random()*(canvas.width - enemy.ENEMY_SIZE));
                enemy.enemyYspeed = Math.floor(Math.random()*(12 - 5) + 3);
            }
            
            if(enemy.enemyYpos + enemy.ENEMY_SIZE > playerYpos && enemy.enemyYpos < playerYpos + PLAYER_SIZE && enemy.enemyXpos + enemy.ENEMY_SIZE > playerXpos && enemy.enemyXpos < playerXpos + PLAYER_SIZE){
               playerXpos = 250;
               playerYpos = 500;
               life--;
                console.log('life:' + life);
               }
            });
        }// Enemy moving and collision
    
        // Key Pressed Function
        function keyPressed(evt){
            if(evt.keyCode == LEFT_KEY){
                leftKeyPress = true;
            }
            if(evt.keyCode == RIGHT_KEY){
                rightKeyPress = true;
            }
            if(evt.keyCode == UP_KEY){
                upKeyPress = true;
            }
            if(evt.keyCode == DOWN_KEY){
                downKeyPress == true;
            }
        }
        
        // Key Released Function
        function keyReleased(evt){
            if(evt.keyCode == LEFT_KEY){
                leftKeyPress = false;
            }
            if(evt.keyCode == RIGHT_KEY){
                rightKeyPress = false;
            }
            if(evt.keyCode == UP_KEY){
                upKeyPress = false;
            }
            if(evt.keyCode == DOWN_KEY){
                downKeyPress = false;
            }
            
        }
        //player moves
    function playerMove(){
        if (leftKeyPress){
            playerXpos -= playerXspeed;
        }
        if (rightKeyPress){
            playerXpos += playerXspeed;
        }
        if (upKeyPress){
            playerYpos -= playerYspeed;
        }
        if (leftKeyPress){
            playerYpos += playerYspeed;
        }
    }

    function colorRect(x,y,w,h,c){
        canvasContext.fillStyle = c;
        canvasContext.fillRect(x,y,w,h);
    }

    function drawImage(src,x,y,w,h){
        canvasContext.drawImage(src,x,y,w,h);

    }

        
    </script>
</body>